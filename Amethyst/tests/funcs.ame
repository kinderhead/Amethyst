namespace test;

#test
void test_dyn_call() {
    start("dyn call");

    var f1 = dyn_func1;
    var f2 = dyn_func2;

    assert(f1(6) == 8);
    assert(f2(6) == 4);

    complete();
}

#test
void test_inline_simple() {
    start("inline simple");

    int x = 2;
    assert(x == 2);
    simple_inline();
    assert(x == 2);

    complete();
}

#test
void test_macro_propagation() {
    start("macro propagation");
    
    assert(propagate(2) == 1);
    assert(propagate(-3) == -6);

    complete();
}

int dyn_func1(int x) {
    return x + 2;
}

int dyn_func2(macro int x) {
    return x - 2;
}

inline void simple_inline() {
    int x = 7;
    assert(x == 7);
}

int propagate(macro int x) {
    if (x < 0) {
        return x * 2;
    } else {
        return x - 1;
    }

    return 0; // I'll have to make it smarter at some point
}
