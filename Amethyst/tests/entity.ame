namespace test;

#test
void test_entity_exists() {
    start("entity exists");

    @/kill @e[type=wither]
    
    macro_entity_tester(false);
    assert(!@e[type="wither"]);

    @/summon wither

    macro_entity_tester(true);
    assert(@e[type="wither"]);

    @/kill @e[type=wither]

    macro_entity_tester(false);
    assert(!@e[type="wither"]);

    complete();
}

void macro_entity_tester(macro bool x) {
    string type = "wither";

    if (@e[type=type]) {
        assert(x);
    } else {
        assert(!x);
    }
}

#test
void test_entity_negate() {
    start("entity negate");

    @/kill @e[type=wither]
    @/summon wither ~ ~ ~ { CustomName: "womp1" }
    @/summon wither ~ ~ ~ { CustomName: "womp2" }

    assert(!@e[type="wither",name=!"womp1",name=!"womp2"]);

    @/summon wither

    assert(@e[type="wither",name=!"womp1",name=!"womp2"]);

    @/kill @e[type=wither]

    complete();
}

#test
void test_entity_tag() {
    start("entity tag");

    @/kill @e[type=wither]
    
    unsafe_string tag = "womp";

    @/summon wither
    @/tag @e[type=wither] add $(tag)
    
    assert(@e[tag=tag]);

    @/kill @e[type=wither]

    complete();
}
