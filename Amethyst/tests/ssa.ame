namespace test;

#test
void test_mem2reg_simple() {
    start("mem2reg simple");
    
    int x = 1;
    int y = 2;

    if (_optimization_preventer(true)) {
        x = 100;
    } else {
        y = 200;
    }

    assert_eq(x + y, 102);

    x = 1;
    y = 2;

    if (_optimization_preventer(false)) {
        x = 100;
    } else {
        y = 200;
    }

    assert_eq(x + y, 201);

    complete();
}

#test
void test_mem2reg_complex() {
    start("mem2reg complex");
    
    int x = 4;

    assert_eq(x, 4);

    if (_optimization_preventer(true)) {
        x = 3 * x;
    } else {
        x = 6 + x;
    }

    assert_eq(x, 12);

    for (int i = 0; i < 4; ++i) {
        x += i;
    }

    assert_eq(x, 18);

    complete();
}

bool _optimization_preventer(bool val) {
    return val;
}
