namespace test;

string currentTest = "None";
bool currentTestFailed = false;
int successfulTests = 0;
int ticksSinceStart = 0;

#load
void init() {
    @/forceload add -64 -64 64 64
}

#tick
void executor() {
    ++ticksSinceStart;

    // Hopefully resolves issues with entities not working on world load
    if (ticksSinceStart == 5) {
        run_tests();
    }
}

void run_tests() {
    print("Running tests");

    @/function #test:test

    var total = count_of("test:test");

    print("Tests passed: ", successfulTests, "/", total);
    //@/say Tests passed: $(successfulTests)/$(total)

    amethyst:exit();
}

void start(string name) {
    currentTest = name;
    currentTestFailed = false;
}

void assert(bool condition) {
    if (condition == 0) currentTestFailed = true;
}

void complete() {
    if (currentTestFailed) {
        print("--> Test \"", currentTest, "\" failed");
    } else {
        print("Test \"", currentTest, "\" passed");
        successfulTests = successfulTests + 1;
    }
}