namespace amethyst:core/entity;

amethyst:dummy ref() {
    // Need to implement a bunch of stuff
    amethyst:dummy id;

    target t = (target)"@s[scores={amethyst_id=0..}]";
    if (t) {
        @/execute store result $(^id) int 1 run scoreboard players get @s amethyst_id
        return id;
    }
    
    id = (amethyst:dummy)random(1, 2147483646);
    @/data modify $(^t) set value "@e[scores={amethyst_id=$(id)}]"

    if (t) {
        return ref();
    }

    @/scoreboard players set @s amethyst_id $(id)
    return id;
}
